<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configurations &mdash; Robotic Python Library 0.1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=01f34227"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="BotOp (Robot Operation) interface" href="1b-botop.html" />
    <link rel="prev" title="Tutorials" href="../tutorials.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Robotic Python Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../tutorials.html#basics-on-configurations-botop-komo">Basics on Configurations, BotOp &amp; KOMO</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Configurations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Building-a-configuration-from-scratch">Building a configuration from scratch</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Specifying-transformations:-Quaternions-&amp;-turtle-strings">Specifying transformations: Quaternions &amp; turtle strings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Loading-existing-configurations">Loading existing configurations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Features:-computing-geometric-properties">Features: computing geometric properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Joint-and-Frame-State">Joint and Frame State</a></li>
<li class="toctree-l4"><a class="reference internal" href="#View-interaction-and-releasing-objects">View interaction and releasing objects</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="1b-botop.html">BotOp (Robot Operation) interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="1c-komo.html">KOMO: Motion Optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="1d-real.html">Starting with a real robot</a></li>
<li class="toctree-l3"><a class="reference internal" href="features.html">Differentiable Features &amp; Collision Evaluation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#in-depth">In Depth</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../script/script.html">Lecture Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rai.html">rai python API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Robotic Python Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../tutorials.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Configurations</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorials/1a-configurations.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Configurations">
<h1>Configurations<a class="headerlink" href="#Configurations" title="Link to this heading"></a></h1>
<p>A configuration is essentially a tree of (coordinate) frames, where each frame can have an associated shape, joint, inertia, etc. This tutorial introduces first steps to creating &amp; loading configurations in rai, setting/getting the joint and frame state, computing features, and handling the view window.</p>
<p>Please see the <a class="reference external" href="https://marctoussaint.github.io/robotics-course/script/script.html#scene-robot-description">Script:Configurations</a> of configurations and degrees-of-freedom.</p>
<section id="Building-a-configuration-from-scratch">
<h2>Building a configuration from scratch<a class="headerlink" href="#Building-a-configuration-from-scratch" title="Link to this heading"></a></h2>
<p>Let’s first build a configuration from scratch by adding frames and setting properties such as pose, shape and parentship of frames.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from robotic import ry
import numpy as np
import time
print(&#39;version:&#39;, ry.__version__, ry.compiled())
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
version: 0.0.23 compile time: Oct 20 2023 14:36:37
</pre></div></div>
</div>
<p>The following creates an empty configuration, and opens a view window for it.</p>
<p>Tip: Make the view window appear “Always On Top” (right click on the window bar).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>C = ry.Config()
C.view()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>A configuration is essentially a tree (or forrest) of frames. Let’s add a frame and set positions manually. We declare it a <strong>marker</strong> frame, which means it has no real shape, but is displayed using its base vectors in the view.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>C.clear()
f = C.addFrame(name=&#39;first&#39;)
f.setShape(type=ry.ST.marker, size=[.3])
f.setPosition([0.,0.,.5])
f.setQuaternion([1., .3, .0, .0]) # more about quaternions below
print(&#39;frame name:&#39;, f.name, &#39;pos:&#39;, f.getPosition(), &#39;quat:&#39;, f.getQuaternion())
C.view()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
frame name: first pos: [0.  0.  0.5] quat: [0.95782629 0.28734789 0.         0.        ]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>Let’s add a second frame, but with first as parent and with a hinge joint!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>f = C.addFrame(name=&#39;second&#39;, parent=&#39;first&#39;)
f.setJoint(ry.JT.hingeX)
f.setShape(type=ry.ST.marker, size=[.4])
f.setColor([1,0,0])
print(&#39;frame name:&#39;, f.name, &#39;pos:&#39;, f.getPosition(), &#39;quat:&#39;, f.getQuaternion())
C.view()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
frame name: second pos: [0.  0.  0.5] quat: [-0.95782629 -0.28734789 -0.         -0.        ]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>Since we now have a configuration with a joint, we can articulate it:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>q = C.getJointState()
q[0] = q[0] + .2
C.setJointState(q)
print(&#39;joint state:&#39;, q)
C.view()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
joint state: [0.2]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>For illustration, let’s add various other child frames with shapes to the ‘second’ frame and animate it with a trivial loop:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>C.addFrame(&#39;ball&#39;, &#39;second&#39;) .setShape(ry.ST.sphere, [.1]) .setColor([1.,.5,.0]) .setRelativePosition([-.3,.0,.2])
C.addFrame(&#39;box&#39;, &#39;second&#39;) .setShape(ry.ST.ssBox, [.3,.2,.1,.02]) .setColor([.5,1.,.0]) .setRelativePosition([.0,.0,.2])
C.addFrame(&#39;capsule&#39;, &#39;second&#39;) .setShape(ry.ST.capsule, [.3, .05]) .setColor([.0,1.,.5]) .setRelativePosition([.3,.0,.2])
for t in range(100):
    C.setJointState([np.cos(.1*t)])
    C.view()
    time.sleep(.1)
</pre></div>
</div>
</div>
<p>The following lists all predefined shape types:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ry.ST.__members__.keys()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;none&#39;, &#39;box&#39;, &#39;sphere&#39;, &#39;capsule&#39;, &#39;mesh&#39;, &#39;cylinder&#39;, &#39;marker&#39;, &#39;pointCloud&#39;, &#39;ssCvx&#39;, &#39;ssBox&#39;, &#39;ssCylinder&#39;, &#39;ssBoxElip&#39;, &#39;quad&#39;, &#39;camera&#39;, &#39;sdf&#39;])
</pre></div></div>
</div>
<p>For most of these, the <code class="docutils literal notranslate"><span class="pre">size</span></code> fully specifies them (box: 3 widths, sphere: radius, capsule: [length radius], cylinder: [length radius], marker: [axes lengths]). The <code class="docutils literal notranslate"><span class="pre">ssBox</span></code> is a sphere-swept-Box with a 4D size: [3 widths, corner radius], which is used a lot. Also mesh shapes can be set manually from python (<code class="docutils literal notranslate"><span class="pre">setMesh</span></code>) by directly giving vertex and triangle arrays. <code class="docutils literal notranslate"><span class="pre">ssCvx</span></code> means sphere-swept convex mesh, which is specified by a mesh and 1D size (radius), and also a very useful shape type.</p>
<p>Let’s also briefly list the possible joint types:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ry.JT.__members__.keys()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;hingeX&#39;, &#39;hingeY&#39;, &#39;hingeZ&#39;, &#39;transX&#39;, &#39;transY&#39;, &#39;transZ&#39;, &#39;transXY&#39;, &#39;trans3&#39;, &#39;transXYPhi&#39;, &#39;transYPhi&#39;, &#39;universal&#39;, &#39;rigid&#39;, &#39;quatBall&#39;, &#39;phiTransXY&#39;, &#39;XBall&#39;, &#39;free&#39;, &#39;generic&#39;, &#39;tau&#39;])
</pre></div></div>
</div>
<p>Please see the <a class="reference external" href="https://marctoussaint.github.io/robotics-course/script/script.html#kinematics">Script:Kinematics</a> on the basics of such joints (=parameterized transformations). The <code class="docutils literal notranslate"><span class="pre">quatBall</span></code> perhaps deserves special explanation: it realizes a ball joint by introducing the 4D quaternion as joint state - this sometimes requires special attention. But the rai code implements correct Jacobians (accounting also for implicit normalization) w.r.t. the quaternion parameterization. The <code class="docutils literal notranslate"><span class="pre">free</span></code>
joint is a 7D joint with 3D position and <code class="docutils literal notranslate"><span class="pre">quatBall</span></code>.</p>
<p>There is also a <code class="docutils literal notranslate"><span class="pre">rigid</span></code> joint, which simply means no DOF and seems fully redundant: having no joint or a rigid joint is the same. However, there is a semantic difference. A child frame without joint is really considered to be <em>a part</em> of the parent: The parent could be a <em>link</em> with multiple shapes (e.g. convex parts) or masses associated, but it is semantically one big link. When a frame has a joint (including a <code class="docutils literal notranslate"><span class="pre">rigid</span></code> joint), it is not considered part of its parent. That semantics rarely
makes a difference, but it does in certain picking or walking scenarios, where objects, endeffectors or feet <em>attach</em> to other objects via a rigid joint.</p>
</section>
<section id="Specifying-transformations:-Quaternions-&amp;-turtle-strings">
<h2>Specifying transformations: Quaternions &amp; turtle strings<a class="headerlink" href="#Specifying-transformations:-Quaternions-&-turtle-strings" title="Link to this heading"></a></h2>
<p>See the <a class="reference external" href="https://marctoussaint.github.io/robotics-course/script/script.html#d-transformations-rotations-quaternions">Script:Transformations</a> on background on 3D transformations, rotations, and quaternions. We use the (w,x,y,z) convention for quaternions. Whenever you set a quaternion manually, it is internally normalized. So setting a quaterniong (1,1,0,0) is totally fine and means 90-degrees around x:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>C.clear()
C.addFrame(&#39;A&#39;) .setShape(ry.ST.marker, [.3]) .setPosition([0.,0.,.5]) .setQuaternion([1., 1., .0, .0])
C.view()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>But to specify transformations using translation and quaternion is not always intuitive as a human. Therefore, we also allow for a <em>turtle string</em> notation, namely a string that chains little interpretable ‘translate’ and ‘rotate’ commands to define a transformation, as in the old turtle language. Here is an example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>C.clear()
f = C.addFrame(&#39;A&#39;) .setShape(ry.ST.marker, [.3])
f.setPose(&#39;t(0 0 .5) d(30 1 0 0) t(0 0 .5) d(30 1 0 0)&#39;) #t=translate, #d=rotate-by-degrees around axis
C.view()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>Here is a specification of the possible commands:</p>
<pre>
  t(x y z)       # translation by (x,y,z)
  q(q0 q1 q2 q3) # rotation by a quaternion
  r(r x y z)     # rotation by `r` _radians_ around the axis (x,y,z)
  d(d x y z)     # rotation by `d` _degrees_ around the axis (x,y,z)
  E(r p y)       # rotation by roll-pitch-yaw Euler angles
</pre></section>
<section id="Loading-existing-configurations">
<h2>Loading existing configurations<a class="headerlink" href="#Loading-existing-configurations" title="Link to this heading"></a></h2>
<p>You will usually load predefined configurations from file, and then perhaps edit and combine them manually. The rai package has several robot models predefined and installed in the <code class="docutils literal notranslate"><span class="pre">raiPath</span></code>. They typically have the <code class="docutils literal notranslate"><span class="pre">.g</span></code>-file extension (see <a class="reference external" href="https://marctoussaint.github.io/robotics-course/script/script.html#graph-yaml-files">Script:gFiles</a> on this file format, which is a yaml-conform graph file). Converting from URDF to configuration files is possible (see advanced tutorial).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>C.clear()
C.addFile(ry.raiPath(&#39;panda/panda.g&#39;))
C.view()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>Let’s add a second panda, but to avoid frame name conflicts we prefix all frame names. That’s often important when importing multiple models into a single configuration. The can then also move the second robot simply by redefining the position of its base frame.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>C.addFile(ry.raiPath(&#39;panda/panda.g&#39;), &#39;r_&#39;)
base_r = C.getFrame(&#39;r_panda_base&#39;)
base_r.setPosition([.0, .5, .0])
C.view()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>These models have several joints. We can get the joint state of the full configuration:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(C.getJointState())
print(&#39;joints:&#39;, C.getJointNames())
print(&#39;frames:&#39;, C.getFrameNames())
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ 0.   -1.    0.   -2.    0.    2.    0.    0.05  0.   -1.    0.   -2.
  0.    2.    0.    0.05]
joints: [&#39;panda_joint1&#39;, &#39;panda_joint2&#39;, &#39;panda_joint3&#39;, &#39;panda_joint4&#39;, &#39;panda_joint5&#39;, &#39;panda_joint6&#39;, &#39;panda_joint7&#39;, &#39;panda_finger_joint1panda_finger_joint2&#39;, &#39;r_panda_joint1&#39;, &#39;r_panda_joint2&#39;, &#39;r_panda_joint3&#39;, &#39;r_panda_joint4&#39;, &#39;r_panda_joint5&#39;, &#39;r_panda_joint6&#39;, &#39;r_panda_joint7&#39;, &#39;r_panda_finger_joint1r_panda_finger_joint2&#39;]
frames: [&#39;panda_base&#39;, &#39;panda_link0&#39;, &#39;panda_link0_0&#39;, &#39;panda_joint1_origin&#39;, &#39;panda_joint1&#39;, &#39;panda_link1&#39;, &#39;panda_link1_0&#39;, &#39;panda_joint2_origin&#39;, &#39;panda_joint2&#39;, &#39;panda_link2&#39;, &#39;panda_link2_0&#39;, &#39;panda_joint3_origin&#39;, &#39;panda_joint3&#39;, &#39;panda_link3&#39;, &#39;panda_link3_0&#39;, &#39;panda_joint4_origin&#39;, &#39;panda_joint4&#39;, &#39;panda_link4&#39;, &#39;panda_link4_0&#39;, &#39;panda_joint5_origin&#39;, &#39;panda_joint5&#39;, &#39;panda_link5&#39;, &#39;panda_link5_0&#39;, &#39;panda_joint6_origin&#39;, &#39;panda_joint6&#39;, &#39;panda_link6&#39;, &#39;panda_link6_0&#39;, &#39;panda_joint7_origin&#39;, &#39;panda_joint7&#39;, &#39;panda_link7&#39;, &#39;panda_link7_0&#39;, &#39;panda_joint8_origin&#39;, &#39;panda_joint8&#39;, &#39;panda_link8&#39;, &#39;panda_hand_joint_origin&#39;, &#39;panda_hand_joint&#39;, &#39;panda_hand&#39;, &#39;panda_hand_0&#39;, &#39;panda_finger_joint1_origin&#39;, &#39;panda_finger_joint2_origin&#39;, &#39;panda_finger_joint1&#39;, &#39;panda_finger_joint2&#39;, &#39;panda_leftfinger&#39;, &#39;panda_rightfinger&#39;, &#39;panda_leftfinger_0&#39;, &#39;panda_rightfinger_0&#39;, &#39;panda_coll0&#39;, &#39;panda_coll0b&#39;, &#39;panda_coll1&#39;, &#39;panda_coll3&#39;, &#39;panda_coll5&#39;, &#39;panda_coll2&#39;, &#39;panda_coll4&#39;, &#39;panda_coll6&#39;, &#39;panda_coll7&#39;, &#39;gripper&#39;, &#39;palm&#39;, &#39;finger1&#39;, &#39;finger2&#39;, &#39;r_panda_base&#39;, &#39;r_panda_link0&#39;, &#39;r_panda_link0_0&#39;, &#39;r_panda_joint1_origin&#39;, &#39;r_panda_joint1&#39;, &#39;r_panda_link1&#39;, &#39;r_panda_link1_0&#39;, &#39;r_panda_joint2_origin&#39;, &#39;r_panda_joint2&#39;, &#39;r_panda_link2&#39;, &#39;r_panda_link2_0&#39;, &#39;r_panda_joint3_origin&#39;, &#39;r_panda_joint3&#39;, &#39;r_panda_link3&#39;, &#39;r_panda_link3_0&#39;, &#39;r_panda_joint4_origin&#39;, &#39;r_panda_joint4&#39;, &#39;r_panda_link4&#39;, &#39;r_panda_link4_0&#39;, &#39;r_panda_joint5_origin&#39;, &#39;r_panda_joint5&#39;, &#39;r_panda_link5&#39;, &#39;r_panda_link5_0&#39;, &#39;r_panda_joint6_origin&#39;, &#39;r_panda_joint6&#39;, &#39;r_panda_link6&#39;, &#39;r_panda_link6_0&#39;, &#39;r_panda_joint7_origin&#39;, &#39;r_panda_joint7&#39;, &#39;r_panda_link7&#39;, &#39;r_panda_link7_0&#39;, &#39;r_panda_joint8_origin&#39;, &#39;r_panda_joint8&#39;, &#39;r_panda_link8&#39;, &#39;r_panda_hand_joint_origin&#39;, &#39;r_panda_hand_joint&#39;, &#39;r_panda_hand&#39;, &#39;r_panda_hand_0&#39;, &#39;r_panda_finger_joint1_origin&#39;, &#39;r_panda_finger_joint2_origin&#39;, &#39;r_panda_finger_joint1&#39;, &#39;r_panda_finger_joint2&#39;, &#39;r_panda_leftfinger&#39;, &#39;r_panda_rightfinger&#39;, &#39;r_panda_leftfinger_0&#39;, &#39;r_panda_rightfinger_0&#39;, &#39;r_panda_coll0&#39;, &#39;r_panda_coll0b&#39;, &#39;r_panda_coll1&#39;, &#39;r_panda_coll3&#39;, &#39;r_panda_coll5&#39;, &#39;r_panda_coll2&#39;, &#39;r_panda_coll4&#39;, &#39;r_panda_coll6&#39;, &#39;r_panda_coll7&#39;, &#39;r_gripper&#39;, &#39;r_palm&#39;, &#39;r_finger1&#39;, &#39;r_finger2&#39;]
</pre></div></div>
</div>
<p>Let’s animate - without respect for limits or collisions! (E.g., the fingers go out of limits.)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>q0 = C.getJointState()
for t in range(20):
    q = q0 + .1*np.random.randn(q0.shape[0])
    C.setJointState(q)
    C.view()
    time.sleep(.2)
</pre></div>
</div>
</div>
</section>
<section id="Features:-computing-geometric-properties">
<h2>Features: computing geometric properties<a class="headerlink" href="#Features:-computing-geometric-properties" title="Link to this heading"></a></h2>
<p>For every frame we can query its pose:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>f = C.getFrame(&#39;r_gripper&#39;)
print(&#39;gripper pos:&#39;, f.getPosition())
print(&#39;gripper quat:&#39;, f.getQuaternion())
print(&#39;gripper rot:&#39;, f.getRotationMatrix())
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
gripper pos: [0.22972161 0.63675584 0.81163634]
gripper quat: [-0.79663237 -0.24376386  0.46490269  0.29970242]
gripper rot: [[ 0.3880879   0.25085235 -0.8868263 ]
 [-0.70415824  0.70151528 -0.10971544]
 [ 0.59459982  0.66704528  0.44888934]]
</pre></div></div>
</div>
<p>The above provides basic forward kinematics: After <code class="docutils literal notranslate"><span class="pre">setJointState</span></code> you can query the pose of any configuration frame.</p>
<p>However, there is a more general way to query <em>features</em> (see <a class="reference external" href="https://marctoussaint.github.io/robotics-course/script/script.html#general-concept-of-differentiable-features">Script:Features</a>), i.e. properties of the configuration in a differentiable manner. You might not use this directly often; but defining differentiable features is the foundation of how optimization problems are formulated, which you will need a lot.</p>
<p>Here are some example features to evaluate:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>[y,J] = C.eval(ry.FS.position, [&#39;gripper&#39;])
print(&#39;position of gripper:&#39;, y, &#39;\nJacobian:&#39;, J)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
position of gripper: [0.1938467  0.05571584 0.92707862]
Jacobian: [[-5.57158418e-02  5.93961135e-01 -1.59973178e-02 -3.74233985e-01
   3.40893538e-03 -3.55845920e-02  4.33680869e-18  0.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00  0.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00  0.00000000e+00]
 [ 1.93846702e-01 -1.18141540e-02  6.14899795e-01  3.09760548e-02
   1.46708625e-01  3.69133387e-02  5.55111512e-17  0.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00  0.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00  0.00000000e+00]
 [ 0.00000000e+00 -1.92700374e-01 -5.24486684e-02  4.31994181e-01
  -2.28855824e-02  2.31333401e-01  5.20417043e-18  0.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00  0.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00  0.00000000e+00]]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># negative(!) distance between two convex shapes (or origin of marker)
C.eval(ry.FS.negDistance, [&#39;panda_coll7&#39;, &#39;r_panda_coll7&#39;])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([-0.40236503]),
 array([[-2.42147163e-02,  9.94071777e-03,  5.57838017e-01,
         -2.81537448e-02, -4.43005956e-02, -9.59797410e-05,
          1.82288149e-16, -0.00000000e+00,  5.00697618e-03,
         -1.37520471e-02, -5.44630216e-01,  1.79043783e-02,
          7.34786608e-02,  1.94588018e-02, -1.88400330e-17,
         -0.00000000e+00]]))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># the x-axis of the given frame in world coordinates
C.eval(ry.FS.vectorX, [&#39;gripper&#39;])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([ 0.14746986, -0.58349898,  0.79861228]),
 array([[ 0.58349898,  0.79845435,  0.29047621, -0.73479687,  0.50459046,
         -0.69895086, -0.17492902,  0.        ,  0.        ,  0.        ,
          0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
          0.        ],
        [ 0.14746986, -0.01588162,  0.77300206, -0.01285582, -0.4321508 ,
          0.04105352, -0.81009853,  0.        ,  0.        ,  0.        ,
          0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
          0.        ],
        [ 0.        , -0.15904446,  0.51114844,  0.12629287, -0.40892364,
          0.159062  , -0.55958932,  0.        ,  0.        ,  0.        ,
          0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
          0.        ]]))
</pre></div></div>
</div>
</section>
<section id="Joint-and-Frame-State">
<h2>Joint and Frame State<a class="headerlink" href="#Joint-and-Frame-State" title="Link to this heading"></a></h2>
<p>A configuration is a tree of n frames. Every frame has a pose (position &amp; quaternion), which is represented as a 7D vector (x,y,z, qw,qx,qy,qz). The frame state is the <span class="math notranslate nohighlight">\(n\times 7\)</span> matrix, where the i-th row is the pose of the i-th frame.</p>
<p>A configuration also defines joints, which means that the relative transfromation from a parent to a child frame is parameterized by degrees-of-freedoms (DOFs). If the configuration has in total n DOFs, the joint state is a n-dimensional vector.</p>
<p>Setting the joint state implies computing all relative transformations, and then forward chaining all transformations to compute all frame poses. So setting the joint state also sets the frame state.</p>
<p>Setting the frame state allows you to set frame poses that are inconsistent/impossible w.r.t. the joints! Setting the frame state implies computing all relative transformations from the frame poses, and then assigning the joint state to the <em>projection</em> onto the actual DOFs</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>C.setJointState(q0)
C.view()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>The <em>frame state</em> is a <span class="math notranslate nohighlight">\(n\times 7\)</span> matrix, which contains for all of <span class="math notranslate nohighlight">\(n\)</span> frames the 7D pose. A pose is stored as [p_x, p_y, p_z, q_w, q_x, q_y, q_z], with position p and quaternion q.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>X0 = C.getFrameState()
print(&#39;frame state: &#39;, X0)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
frame state:  [[ 0.00000000e+00  0.00000000e+00  0.00000000e+00  1.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00]
 [ 0.00000000e+00  0.00000000e+00  0.00000000e+00  1.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00]
 [ 0.00000000e+00  0.00000000e+00  0.00000000e+00  1.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00]
 [ 0.00000000e+00  0.00000000e+00  3.33000000e-01  1.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00]
 [ 0.00000000e+00  0.00000000e+00  3.33000000e-01  1.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00]
 [ 0.00000000e+00  0.00000000e+00  3.33000000e-01  1.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00]
 [ 0.00000000e+00  0.00000000e+00  3.33000000e-01  1.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00]
 [ 0.00000000e+00  0.00000000e+00  3.33000000e-01  7.07106781e-01
  -7.07106781e-01  0.00000000e+00  0.00000000e+00]
 [ 0.00000000e+00  0.00000000e+00  3.33000000e-01  6.20544581e-01
  -6.20544581e-01 -3.39005049e-01 -3.39005049e-01]
 [ 0.00000000e+00  0.00000000e+00  3.33000000e-01  6.20544581e-01
  -6.20544581e-01 -3.39005049e-01 -3.39005049e-01]
 [ 0.00000000e+00  0.00000000e+00  3.33000000e-01  6.20544581e-01
  -6.20544581e-01 -3.39005049e-01 -3.39005049e-01]
 [-2.65904831e-01 -1.05249143e-16  5.03735529e-01  8.77582562e-01
   0.00000000e+00 -4.79425539e-01  0.00000000e+00]
 [-2.65904831e-01 -1.05249143e-16  5.03735529e-01  8.77582562e-01
   0.00000000e+00 -4.79425539e-01  0.00000000e+00]
 [-2.65904831e-01 -1.05249143e-16  5.03735529e-01  8.77582562e-01
   0.00000000e+00 -4.79425539e-01  0.00000000e+00]
 [-2.65904831e-01 -1.05249143e-16  5.03735529e-01  8.77582562e-01
   0.00000000e+00 -4.79425539e-01  0.00000000e+00]
 [-2.21329891e-01 -1.05249143e-16  5.73156885e-01  6.20544581e-01
   6.20544581e-01 -3.39005049e-01  3.39005049e-01]
 [-2.21329891e-01 -1.05249143e-16  5.73156885e-01  6.20544581e-01
   6.20544581e-01  3.39005049e-01 -3.39005049e-01]
 [-2.21329891e-01 -1.05249143e-16  5.73156885e-01  6.20544581e-01
   6.20544581e-01  3.39005049e-01 -3.39005049e-01]
 [-2.21329891e-01 -1.05249143e-16  5.73156885e-01  6.20544581e-01
   6.20544581e-01  3.39005049e-01 -3.39005049e-01]
 [ 5.72200270e-02  2.67785794e-16  8.50054327e-01  8.77582562e-01
   0.00000000e+00  4.79425539e-01  0.00000000e+00]
 [ 5.72200270e-02  2.67785794e-16  8.50054327e-01  8.77582562e-01
   0.00000000e+00  4.79425539e-01  0.00000000e+00]
 [ 5.72200270e-02  2.67785794e-16  8.50054327e-01  8.77582562e-01
   0.00000000e+00  4.79425539e-01  0.00000000e+00]
 [ 5.72200270e-02  2.67785794e-16  8.50054327e-01  8.77582562e-01
   0.00000000e+00  4.79425539e-01  0.00000000e+00]
 [ 5.72200270e-02  2.67785794e-16  8.50054327e-01  6.20544581e-01
   6.20544581e-01  3.39005049e-01 -3.39005049e-01]
 [ 5.72200270e-02  2.67785794e-16  8.50054327e-01  6.20544581e-01
   6.20544581e-01 -3.39005049e-01  3.39005049e-01]
 [ 5.72200270e-02  2.67785794e-16  8.50054327e-01  6.20544581e-01
   6.20544581e-01 -3.39005049e-01  3.39005049e-01]
 [ 5.72200270e-02  2.67785794e-16  8.50054327e-01  6.20544581e-01
   6.20544581e-01 -3.39005049e-01  3.39005049e-01]
 [ 1.04766630e-01  2.67785794e-16  9.24103773e-01  0.00000000e+00
   8.77582562e-01  0.00000000e+00  4.79425539e-01]
 [ 1.04766630e-01  2.67785794e-16  9.24103773e-01  0.00000000e+00
   8.77582562e-01  0.00000000e+00  4.79425539e-01]
 [ 1.04766630e-01  2.67785794e-16  9.24103773e-01  0.00000000e+00
   8.77582562e-01  0.00000000e+00  4.79425539e-01]
 [ 1.04766630e-01  2.67785794e-16  9.24103773e-01  0.00000000e+00
   8.77582562e-01  0.00000000e+00  4.79425539e-01]
 [ 1.94804025e-01  2.67785794e-16  8.66291427e-01  0.00000000e+00
   8.77582562e-01  0.00000000e+00  4.79425539e-01]
 [ 1.94804025e-01  2.67785794e-16  8.66291427e-01  0.00000000e+00
   8.77582562e-01  0.00000000e+00  4.79425539e-01]
 [ 1.94804025e-01  2.67785794e-16  8.66291427e-01  0.00000000e+00
   8.77582562e-01  0.00000000e+00  4.79425539e-01]
 [ 1.94804025e-01  2.67785794e-16  8.66291427e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 1.94804025e-01  2.67785794e-16  8.66291427e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 1.94804025e-01  2.67785794e-16  8.66291427e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 1.94804025e-01  2.67785794e-16  8.66291427e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 2.43945931e-01  2.71027645e-16  8.34737772e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 2.43945931e-01  2.71027645e-16  8.34737772e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 2.63048480e-01 -3.53553800e-02  8.64488229e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 2.24843382e-01  3.53553800e-02  8.04987314e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 2.63048480e-01 -3.53553800e-02  8.64488229e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 2.24843382e-01  3.53553800e-02  8.04987314e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 2.63048480e-01 -3.53553800e-02  8.64488229e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 2.24843382e-01  3.53553800e-02  8.04987314e-01 -4.42931549e-01
   3.35835838e-01 -8.10780761e-01  1.83467955e-01]
 [-4.00000000e-02  0.00000000e+00  3.00000000e-02  7.07106781e-01
   0.00000000e+00  7.07106781e-01  0.00000000e+00]
 [-2.00000000e-01 -1.20000000e-01  0.00000000e+00  7.07106781e-01
   0.00000000e+00  7.07106781e-01  0.00000000e+00]
 [ 0.00000000e+00  0.00000000e+00  1.83000000e-01  1.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00]
 [-1.39684183e-01 -1.05249143e-16  4.22690183e-01  8.77582562e-01
   0.00000000e+00 -4.79425539e-01  0.00000000e+00]
 [-1.11074170e-01  2.00000000e-02  7.41993865e-01  8.77582562e-01
   0.00000000e+00  4.79425539e-01  0.00000000e+00]
 [ 0.00000000e+00  0.00000000e+00  3.33000000e-01  6.20544581e-01
  -6.20544581e-01 -3.39005049e-01 -3.39005049e-01]
 [-2.21329891e-01 -1.05249143e-16  5.73156885e-01  6.20544581e-01
   6.20544581e-01  3.39005049e-01 -3.39005049e-01]
 [ 5.72200270e-02  4.00000000e-02  8.50054327e-01  6.20544581e-01
   6.20544581e-01 -3.39005049e-01  3.39005049e-01]
 [ 1.13181340e-01  2.67785794e-16  9.18700750e-01  0.00000000e+00
   8.77582562e-01  0.00000000e+00  4.79425539e-01]
 [ 2.89890247e-01  2.67785794e-16  8.05237266e-01 -8.10780567e-01
  -1.83468211e-01  4.42931442e-01  3.35836307e-01]
 [ 1.94804025e-01  2.67785794e-16  8.66291427e-01 -4.43577140e-01
   7.03040009e-01  5.50671700e-01  7.57281032e-02]
 [ 3.03197392e-01 -5.51543927e-02  8.62237905e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 2.43597439e-01  5.51543927e-02  7.69416477e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 0.00000000e+00  5.00000000e-01  0.00000000e+00  1.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00]
 [ 0.00000000e+00  5.00000000e-01  0.00000000e+00  1.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00]
 [ 0.00000000e+00  5.00000000e-01  0.00000000e+00  1.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00]
 [ 0.00000000e+00  5.00000000e-01  3.33000000e-01  1.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00]
 [ 0.00000000e+00  5.00000000e-01  3.33000000e-01  1.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00]
 [ 0.00000000e+00  5.00000000e-01  3.33000000e-01  1.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00]
 [ 0.00000000e+00  5.00000000e-01  3.33000000e-01  1.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00]
 [ 0.00000000e+00  5.00000000e-01  3.33000000e-01  7.07106781e-01
  -7.07106781e-01  0.00000000e+00  0.00000000e+00]
 [ 0.00000000e+00  5.00000000e-01  3.33000000e-01  6.20544581e-01
  -6.20544581e-01 -3.39005049e-01 -3.39005049e-01]
 [ 0.00000000e+00  5.00000000e-01  3.33000000e-01  6.20544581e-01
  -6.20544581e-01 -3.39005049e-01 -3.39005049e-01]
 [ 0.00000000e+00  5.00000000e-01  3.33000000e-01  6.20544581e-01
  -6.20544581e-01 -3.39005049e-01 -3.39005049e-01]
 [-2.65904831e-01  5.00000000e-01  5.03735529e-01  8.77582562e-01
   0.00000000e+00 -4.79425539e-01  0.00000000e+00]
 [-2.65904831e-01  5.00000000e-01  5.03735529e-01  8.77582562e-01
   0.00000000e+00 -4.79425539e-01  0.00000000e+00]
 [-2.65904831e-01  5.00000000e-01  5.03735529e-01  8.77582562e-01
   0.00000000e+00 -4.79425539e-01  0.00000000e+00]
 [-2.65904831e-01  5.00000000e-01  5.03735529e-01  8.77582562e-01
   0.00000000e+00 -4.79425539e-01  0.00000000e+00]
 [-2.21329891e-01  5.00000000e-01  5.73156885e-01  6.20544581e-01
   6.20544581e-01 -3.39005049e-01  3.39005049e-01]
 [-2.21329891e-01  5.00000000e-01  5.73156885e-01  6.20544581e-01
   6.20544581e-01  3.39005049e-01 -3.39005049e-01]
 [-2.21329891e-01  5.00000000e-01  5.73156885e-01  6.20544581e-01
   6.20544581e-01  3.39005049e-01 -3.39005049e-01]
 [-2.21329891e-01  5.00000000e-01  5.73156885e-01  6.20544581e-01
   6.20544581e-01  3.39005049e-01 -3.39005049e-01]
 [ 5.72200270e-02  5.00000000e-01  8.50054327e-01  8.77582562e-01
   0.00000000e+00  4.79425539e-01  0.00000000e+00]
 [ 5.72200270e-02  5.00000000e-01  8.50054327e-01  8.77582562e-01
   0.00000000e+00  4.79425539e-01  0.00000000e+00]
 [ 5.72200270e-02  5.00000000e-01  8.50054327e-01  8.77582562e-01
   0.00000000e+00  4.79425539e-01  0.00000000e+00]
 [ 5.72200270e-02  5.00000000e-01  8.50054327e-01  8.77582562e-01
   0.00000000e+00  4.79425539e-01  0.00000000e+00]
 [ 5.72200270e-02  5.00000000e-01  8.50054327e-01  6.20544581e-01
   6.20544581e-01  3.39005049e-01 -3.39005049e-01]
 [ 5.72200270e-02  5.00000000e-01  8.50054327e-01  6.20544581e-01
   6.20544581e-01 -3.39005049e-01  3.39005049e-01]
 [ 5.72200270e-02  5.00000000e-01  8.50054327e-01  6.20544581e-01
   6.20544581e-01 -3.39005049e-01  3.39005049e-01]
 [ 5.72200270e-02  5.00000000e-01  8.50054327e-01  6.20544581e-01
   6.20544581e-01 -3.39005049e-01  3.39005049e-01]
 [ 1.04766630e-01  5.00000000e-01  9.24103773e-01  0.00000000e+00
   8.77582562e-01  0.00000000e+00  4.79425539e-01]
 [ 1.04766630e-01  5.00000000e-01  9.24103773e-01  0.00000000e+00
   8.77582562e-01  0.00000000e+00  4.79425539e-01]
 [ 1.04766630e-01  5.00000000e-01  9.24103773e-01  0.00000000e+00
   8.77582562e-01  0.00000000e+00  4.79425539e-01]
 [ 1.04766630e-01  5.00000000e-01  9.24103773e-01  0.00000000e+00
   8.77582562e-01  0.00000000e+00  4.79425539e-01]
 [ 1.94804025e-01  5.00000000e-01  8.66291427e-01  0.00000000e+00
   8.77582562e-01  0.00000000e+00  4.79425539e-01]
 [ 1.94804025e-01  5.00000000e-01  8.66291427e-01  0.00000000e+00
   8.77582562e-01  0.00000000e+00  4.79425539e-01]
 [ 1.94804025e-01  5.00000000e-01  8.66291427e-01  0.00000000e+00
   8.77582562e-01  0.00000000e+00  4.79425539e-01]
 [ 1.94804025e-01  5.00000000e-01  8.66291427e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 1.94804025e-01  5.00000000e-01  8.66291427e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 1.94804025e-01  5.00000000e-01  8.66291427e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 1.94804025e-01  5.00000000e-01  8.66291427e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 2.43945931e-01  5.00000000e-01  8.34737772e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 2.43945931e-01  5.00000000e-01  8.34737772e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 2.63048480e-01  4.64644620e-01  8.64488229e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 2.24843382e-01  5.35355380e-01  8.04987314e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 2.63048480e-01  4.64644620e-01  8.64488229e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 2.24843382e-01  5.35355380e-01  8.04987314e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 2.63048480e-01  4.64644620e-01  8.64488229e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 2.24843382e-01  5.35355380e-01  8.04987314e-01 -4.42931549e-01
   3.35835838e-01 -8.10780761e-01  1.83467955e-01]
 [-4.00000000e-02  5.00000000e-01  3.00000000e-02  7.07106781e-01
   0.00000000e+00  7.07106781e-01  0.00000000e+00]
 [-2.00000000e-01  3.80000000e-01  0.00000000e+00  7.07106781e-01
   0.00000000e+00  7.07106781e-01  0.00000000e+00]
 [ 0.00000000e+00  5.00000000e-01  1.83000000e-01  1.00000000e+00
   0.00000000e+00  0.00000000e+00  0.00000000e+00]
 [-1.39684183e-01  5.00000000e-01  4.22690183e-01  8.77582562e-01
   0.00000000e+00 -4.79425539e-01  0.00000000e+00]
 [-1.11074170e-01  5.20000000e-01  7.41993865e-01  8.77582562e-01
   0.00000000e+00  4.79425539e-01  0.00000000e+00]
 [ 0.00000000e+00  5.00000000e-01  3.33000000e-01  6.20544581e-01
  -6.20544581e-01 -3.39005049e-01 -3.39005049e-01]
 [-2.21329891e-01  5.00000000e-01  5.73156885e-01  6.20544581e-01
   6.20544581e-01  3.39005049e-01 -3.39005049e-01]
 [ 5.72200270e-02  5.40000000e-01  8.50054327e-01  6.20544581e-01
   6.20544581e-01 -3.39005049e-01  3.39005049e-01]
 [ 1.13181340e-01  5.00000000e-01  9.18700750e-01  0.00000000e+00
   8.77582562e-01  0.00000000e+00  4.79425539e-01]
 [ 2.89890247e-01  5.00000000e-01  8.05237266e-01 -8.10780567e-01
  -1.83468211e-01  4.42931442e-01  3.35836307e-01]
 [ 1.94804025e-01  5.00000000e-01  8.66291427e-01 -4.43577140e-01
   7.03040009e-01  5.50671700e-01  7.57281032e-02]
 [ 3.03197392e-01  4.44845607e-01  8.62237905e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]
 [ 2.43597439e-01  5.55154393e-01  7.69416477e-01  1.83467955e-01
   8.10780761e-01  3.35835838e-01  4.42931549e-01]]
</pre></div></div>
</div>
<p>Let’s do a very questionable thing: adding .1 to all numbers in the frame matrix!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>X = X0 + .1
C.setFrameState(X)
C.view()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>That totally broke the original design of the robot! Setting global frame states overwrites the relative transformations between frames.</p>
<p>(Also, the rows of X have non-normalized quaternions! These are normalized when setting the frame state.)</p>
<p>Let’s reset:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>C.setFrameState(X0)
C.view()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>## Selecting joints</p>
<p>Often one would like to choose which joints are actually active, that is, which joints are referred to in q. This allows one to sub-select joints and work only with projections of the full configuration state. This changes the joint state dimensionality, including ordering of entries in q. The frame state is not affected by such a selection of active joints.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>C.selectJoints([&#39;panda_joint1&#39;, &#39;panda_joint1&#39;])
print(&#39;joint state: &#39;, C.getJointState())
print(&#39;joint names: &#39;, C.getJointNames() )
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
joint state:  [0.]
joint names:  [&#39;panda_joint1&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>C.selectJoints([], True)
print(&#39;joint state: &#39;, C.getJointState())
print(&#39;joint names: &#39;, C.getJointNames() )
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
joint state:  [ 0.      -1.00001  0.      -2.00001  0.       2.00001  0.       0.05
  0.      -1.00001  0.      -2.00001  0.       2.00001  0.       0.05   ]
joint names:  [&#39;panda_joint1&#39;, &#39;panda_joint2&#39;, &#39;panda_joint3&#39;, &#39;panda_joint4&#39;, &#39;panda_joint5&#39;, &#39;panda_joint6&#39;, &#39;panda_joint7&#39;, &#39;panda_finger_joint1panda_finger_joint2&#39;, &#39;r_panda_joint1&#39;, &#39;r_panda_joint2&#39;, &#39;r_panda_joint3&#39;, &#39;r_panda_joint4&#39;, &#39;r_panda_joint5&#39;, &#39;r_panda_joint6&#39;, &#39;r_panda_joint7&#39;, &#39;r_panda_finger_joint1r_panda_finger_joint2&#39;]
</pre></div></div>
</div>
</section>
<section id="View-interaction-and-releasing-objects">
<h2>View interaction and releasing objects<a class="headerlink" href="#View-interaction-and-releasing-objects" title="Link to this heading"></a></h2>
<p>You can close and re-open the view window</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>C.view_close()
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># things are still there
C.view(pause=False, message=&#39;this is a message&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>For user interaction it is often useful to wait for a keypress (making <code class="docutils literal notranslate"><span class="pre">view</span></code> a blocking call):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>keypressed = C.view(True, &#39;press some key!&#39;)
print(&#39;pressed key:&#39;, keypressed, chr(keypressed))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
pressed key: 113 q
</pre></div></div>
</div>
<p>You can also get a screenshot:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>img = C.view_getRgb()
print(type(img), img.shape)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;numpy.ndarray&#39;&gt; (400, 400, 3)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import matplotlib.pyplot as plt
plt.imshow(img)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_1a-configurations_57_0.png" src="../_images/tutorials_1a-configurations_57_0.png" />
</div>
</div>
<p>And release everything, including closing the view</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>del C
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../tutorials.html" class="btn btn-neutral float-left" title="Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="1b-botop.html" class="btn btn-neutral float-right" title="BotOp (Robot Operation) interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Marc Toussaint.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>